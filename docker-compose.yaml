x-kubernetes:
  name: gsfm
  namespace: gsfm

services:
  gsfm-app:
    build: .
    image: maayanlab/gsfm:0.6.2
    platform: linux/amd64
    x-kubernetes:
      imagePullPolicy: IfNotPresent
      annotations:
        maayanlab.cloud/ingress: https://gsfm.maayanlab.cloud
    environment:
      - DATABASE_URL=${PROD_DATABASE_URL:-postgres://postgres:${POSTGRES_PASSWORD}@gsfm-postgres:5432/postgres}
      - NEXT_PUBLIC_URL=https://gsfm.maayanlab.cloud
    ports:
      - 3000
    volumes:
      - gsfm-app-model:/app/model
  gsfm-postgres:
    image: postgres
    environment:
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
    ports:
      - 5432:5432
    volumes:
      - gsfm-postgres:/var/lib/postgresql/data

volumes:
  gsfm-app-model:
    x-kubernetes:
      size: 1Gi
      class: gp2

  gsfm-postgres:
    x-kubernetes:
      size: 100Gi
      class: gp2
